<%- include("partials/header", {title: "Home"}); %>

<body class="puppy-paw-background">
  <%- include('partials/nav.ejs', {active: "calendar"}) %>
  <%- include('partials/modal-todo') %>
  <%- include('partials/modal-todo-delete') %>
  <div class="px-4 py-1 my-3 mx-3 text-center">
    <!-- users name -->
    <div>
      <h1 class="text-success fw-bold mb-2">
        All Tasks
      </h1>
      <img class="mt-1" src="https://www.svgrepo.com/show/177662/clipboard-list.svg" alt="Clipboard with list"
        width="50" height="50">
    </div>

    <!-- todo list -->
    <div class="row mb-3">
      <!-- Datepicker -->
      <div class="mx-auto w-auto">
        <form action="/todos/getDate/" method="post" id="previous" class="vstack gap-3 me-auto">
          <label for="date" class="form-label form-label-lg mt-3 w-100 ms-auto">View tasks by date:</label>
          <input class="form-control form" type="date" name="date" id="date" value="<%= calendar ? calendar : new Date().toISOString().slice(0, 10) %>">
          <button type="submit" class="btn btn-success mb-3">Go</button>
        </form>
      </div>
       <div class="table-responsive"> 
      <table class="table table-hover datatable">
        <thead>
          <tr>
            <th class="text-center" scope="col">Pet</th>
            <th class="text-center" scope="col">Task</th>
            <th class="text-center" scope="col">Date</th>
            <th class="text-center" scope="col">Completed</th>
            <th class="text-center" data-sortable="false" scope="col">Edit</th>
            <th class="text-center" data-sortable="false" scope="col">Delete</th>
          </tr>
        </thead>
        <tbody id="calendarData">
          <% todos.forEach( el=> { %>
            <tr scope="row">
              <td>
                <%= el.petName %>
              </td>
              <td>
                <%= el.todo %>
              </td>
              <td>
                <a class="link-success" href="/todos/<%= new Date(el.date).toISOString().slice(0,10) %>"><%= el.date.toLocaleDateString('en', { year: 'numeric' , month: 'short' , day: '2-digit' }) %></a>
              </td>
              <td>
                <%= el.completed===true ? 'Completed' : 'Not completed' %>
              </td>
              <td><button class="btn btn-success" title="Edit task" aria-label="Edit task"  data-bs-toggle="modal" data-bs-target="#todoEdit-modal" data-id='<%=el._id%>' data-todo='<%=el.todo%>' data-pet='<%=el.petName%>' data-date='<%=el.date%>'><i class="fa-solid fa-pen-to-square"></i></button></td>
              <td><button class="btn btn-danger" title="Delete task" aria-label="Delete task" data-bs-toggle="modal" data-bs-target="#todoDelete-modal" data-id='<%=el._id%>'><i class="fa-solid fa-trash"></i></button></td>
            </tr>
            <% }) %>
        </tbody>
      </table>
    </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
  <script>window.onload = function createtables(){
    const datatables = document.querySelectorAll('.datatable')
  datatables.forEach(datatable => {
    new simpleDatatables.DataTable(datatable, {columns: [
        { select: 2, sort: "asc" }
      ]})
    })
  }
  </script>
  <script src="js/todo.js"></script>
</body>