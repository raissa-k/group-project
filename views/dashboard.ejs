<%- include("partials/header", {title: "Dashboard"}); %>

<body class="puppy-paw-background">
  <%- include('partials/nav', {active: "dashboard"}) %>
    <% if (locals.messages.errors) { %>
    <div class="alertdiv" role="alert">
        <% messages.errors.forEach( el=> { %>
            <div class="alert alert-danger">
                <%= el.msg %>
            </div>
            <% }) %>
    </div>
    <% } %>

        <% if (locals.messages.info) { %>
            <div role="alert" class="infodiv">
                <% messages.info.forEach( el=> { %>
                    <div class="alert alert-danger">
                        <%= el.msg %>
                    </div>
                    <% }) %>
            </div>
            <% } %>


  
  <main class="mx-auto p-4">

    <h1 class="text-success mb-4"><%= user.userName %>'s Dashboard</h1>
    <div class="row">

      <!-- Left side columns -->
      <div class="col-lg-8">
        <div class="row">
          
          <!-- Today's task Card -->
          <div class="col-xxl-4 col-sm-8 col-md-6 mb-4 mx-auto">
            <div class="card">
              <div class="card-header d-flex align-items-center">
                <i class="fa-solid fa-book-open-reader mt-1 text-success fa-2xl align-self-baseline me-3"></i><H2>At a glance</H2>
              </div>
              
              <div class="card-body">
                <p class="lead">You have <span class="text-success"><strong><%= (left > 0) ? left : "no" %> <%= (left > 1) ? "tasks" : "task" %></strong></span> left to do. %></p>
              </div>
              
              <div class="card-footer d-flex justify-content-center gap-2">
                <a class="btn btn-success" href="/calendar">See all dates</a>
                <a class="btn btn-outline-success" href="/todos">View today</a>
              </div>
            </div>
          </div>

          <!-- Datepicker Card -->
          <div class="col-xxl-4 col-sm-8 col-md-6 mb-4 mx-auto">
            <div class="card">
              <div class="card-header d-flex align-items-center">
                <i class="fa-solid fa-calendar-days mt-1 text-success fa-2xl align-self-baseline me-3"></i>
                <h2 id="datepicker-label">Tasks by date</h2>
              </div>
              <div class="card-body">
                <form action="/todos/getDate/" method="post" class="py-1">
                  <input class="form-control form" type="date" name="date" id="date" value="<%= calendar ? calendar.toISOString().slice(0, 10) : new Date().toISOString().slice(0, 10) %>" aria-labelledby="datepicker-label">
                </div>
                  <div class="card-footer d-flex justify-content-center gap-2">
                    <button type="submit" class="btn btn-success">See selected date</button>
                  </div>
                </form>
            </div>
          </div>

        </div>
      </div>
        
      <!-- Creation card -->
      <div class="col-lg-4 col-sm-8 mx-auto mb-4">
        <div class="card">
          <div class="card-header d-flex align-items-center">
            <i class="fa-solid fa-file-circle-plus mt-1 text-success fa-2xl align-self-baseline me-3"></i>
            <h2>Add more</h2>
          </div>
          <div class="card-body">
            <p class="lead">Create a new task or add a new pet!</p>
          </div>
          <div class="card-footer d-flex justify-content-center gap-2">
            <button class="btn btn-success" type="button" data-bs-toggle="modal" data-bs-target="#createPet-modal" aria-expanded="false" aria-controls="createPet-modal">
              <i class="fa-solid fa-circle-plus"></i> Add pet
            </button>

            <button class="btn btn-success" type="button" data-bs-toggle="modal" data-bs-target="#createTodo-modal" aria-expanded="false" aria-controls="createTodo-modal">
              <i class="fa-solid fa-circle-plus"></i> Add task
            </button>
          </div>        
        </div>
      </div>
      </div>
      <!-- End columns -->
        
        <!-- Pet table -->
        <div class="col-12">
          <div class="card overflow-auto">
            <div class="card-header d-flex align-items-center">
              <i class="fa-solid fa-paw text-success mt-1 fa-2xl align-self-baseline me-3"></i>
              <h2 class="text-success">
                <%= user.userName %> has <%= petCount %> <%= (petCount > 1) ? "pets" : "pet" %>.
              </h2>
            </div>
            <div class="card-body table-responsive-md">
              <table class="table table-hover" id="petTable">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Breed</th>
                    <th>Birthday</th>
                    <th>Age</th>
                    <th>Edit</th>
                  <th>Delete</th>
                </tr>
              </thead>
              <tbody>  
              <% pets.forEach (el=> { %>
                <tr data-id='<%=el._id%>'>
                  <td class="text-success">
                    <%= el.petName %>
                  </td>
                <td>
                  <%= el.petBreed %>
                </td>
                <td>
                  <%= el.petBirthday %>
                </td>
                <td>
                  <%= el.petAge %>
                </td>
                <td class="editpet">
                  <button class="btn btn-success" aria-label="Edit pet" title="Edit pet" data-bs-toggle="modal" data-bs-target="#petEdit-modal" data-id='<%=el._id%>' data-name='<%=el.petName%>' data-breed='<%=el.petBreed%>' data-birthday='<%=el.petBirthday%>' data-age='<%=el.petAge%>'>
                    <i class="fa-solid fa-pen-to-square"></i>
                  </button>
                </td>
                <td>
                  <button class="btn btn-danger" aria-label="Delete pet" title="Delete pet" data-bs-toggle="modal" data-bs-target="#petDelete-modal" data-id="<%=el._id%>" data-name="<%=el.petName%>">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>

          </div>
        </div>
        </div>
      </div>
    </main>

  <!--Modals-->
        <%- include("partials/modal-blank", {id: "createPet-modal", title: "Create a pet", textcolor: " ", partial: "form-pet-create", footer: "no" }) %>

        <%- include("partials/modal-blank", {id: "createTodo-modal", title: "Create a task", textcolor: " ", partial: "form-todo-create", footer: "no" }) %>

        <%- include("partials/modal-blank", {id: "petEdit-modal", title: "Edit a pet", textcolor: "text-success", partial: "form-pet-edit", footer: "no" }) %>

        <%- include("partials/modal-blank", {id: "petDelete-modal", title: "Delete a pet", textcolor: "text-danger", partial: "form-pet-delete", footer: "no" }) %>   


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
    <script>window.onload = function createtables(){
        new simpleDatatables.DataTable("#petTable", { sortable: false, perPage: 5, perPageSelect: false, layout: { 
          top: "{search}", 
          bottom: ""
        }, 
        labels: {
          placeholder: "Search pets",
          noRows: "No entries found"
        }, columns: [{
          select: 0, sort: "asc" 
        }]
      })
    }
    </script>
    <script src="js/pet.js"></script>
</body>

</html>